<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<link rel="icon" href="img/icon.ico">
		<link rel="stylesheet" href="css/style.css">
		<link href="https://fonts.googleapis.com/css2?family=Marmelad&display=swap" rel="stylesheet">
		<title>UNO Online</title>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<script src="js/model.js" charset="utf-8"></script>
	</head>
	<body>
		<main id="uno">
			<div v-if="show == 'play' || show == 'create'">
				<form @submit.prevent="chooseUsername()">
					<input class="input" type="text" placeholder="Enter your name" v-model="username">
					<input class="button" type="submit" :value="showInput"></input>
				</form>
			</div>
			<div v-else-if="show == 'waiting'">
				<p><button class="button" @click="startGame()" :disabled="!isMaster || users.length < 2">Start</button></p>
				<ul><li v-for="(user, i) in users">{{user.name}}<span v-if="i == 0"> - Master</span></li></ul>
				<a :href="roomURL">{{roomURL}}</a>
			</div>
			<div id="game" v-else-if="show == 'playing'">
				<div id="table">
					<div class="player" :class="{ owner: player._id == user._id, playing: game.round.turn == indexPlayer }" v-for="(player, indexPlayer) in game.round.players" :style="{ transform: 'rotate('+(-90+360.0/game.round.players.length*(indexPlayer-indexOf(game.players,user,'_id')))+'deg) translateX(-20em)' }">
						<div :style="{ transform: 'rotate('+(90-360.0/game.round.players.length*(indexPlayer-indexOf(game.players,user,'_id')))+'deg)' }">
							<h3 class="player-name">{{player.name}}</h3>
							<div class="cards">
								<div class="card" :class="{ playable: isPlayable(card, indexPlayer) }" :style="{ transform: 'translate('+getCardDatas(player.hand.length,indexCard,indexPlayer).dx+'px, '+getCardDatas(player.hand.length,indexCard,indexPlayer).dy+'px) rotate('+getCardDatas(player.hand.length,indexCard,indexPlayer).a+'rad)' }" v-for="(card, indexCard) in player.hand" @click="if (isPlayable(card, indexPlayer)) { game.play(card); shareGame(); }"><img class="card-img" :src="cardData(player, card).src" :alt="cardData(player, card).alt"></div>
							</div>
						</div>
					</div>
					<span v-if="game.round.switchcolor && game.players[game.round.turn]._id == user._id">Choose a color : <button class="button" v-for="color in colors" @click="game.round.chooseColor(color); shareGame()">{{color}}</button></span>
					<!-- <div id="decks" class="discard"> -->
					<div id="decks" class="cards">
						<div class="discard card"><img class="card-img" :src="'img/cards/'+game.round.deck.discardtop.type+'_'+game.round.deck.discardtop.color+'_'+game.round.deck.discardtop.value+'.png'" :alt="game.round.deck.discardtop.type+' - '+game.round.deck.discardtop.value+' - '+game.round.deck.discardtop.color"></div>
						<div class="deck-separator">
						</div>
						<!-- v-if="!game.round.switchcolor && game.players[game.round.turn]._id == user._id" -->
						<div class="deck card" :class="{ playable: !this.game.round.switchcolor && this.game.players[this.game.round.turn]._id == this.user._id }" v-if="game.round.deck.cards.length > 0" @click="drawCards()"><img class="card-img" src="img/cards/back.png" alt="UNO Card"></div>
						<button class="end-turn button" v-if="game.round.drawed && game.players[game.round.turn]._id == user._id" @click="game.round.addTurn(); game.round.drawed = false; shareGame()">End turn</button>
					</div>
					<!-- </div> -->
				</div>
			</div>
			<div v-if="show == 'waiting' || show == 'playing'">
				<div id="scoreboard">
					<h1>Scoreboard</h1>
					<div class="scoreboard-box">
						<ul v-if="show == 'playing'">
							<li v-for="(player, i) in game.players">{{player.name}} | {{game.scores[i]}}</li>
						</ul>
					</div>
				</div>
				<div id="chat">
					<h1>Chat</h1>
					<div class="messages">
						<ul class="unordered-list">
							<li class="list" :class="{ debug: msg.debug }" v-for="msg in chat"><span :style="{ fontWeight: msg.weight }">{{msg.username}}</span>{{msg.message}}</li>
						</ul>
					</div>
					<form class="chat-form" @submit.prevent="sendMessage()"><input class="chat-input" type="text" placeholder="Chat here" v-model="message"></input><input class="button chat-button" type="submit" value="Send"></input></form>
				</div>
			</div>
		</main>
		<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
		<script src="js/vue.js" charset="utf-8"></script>
		<script src="js/client.js" charset="utf-8"></script>
	</body>
</html>
